<link rel="import" href="../shadycss/apply-shim.html">
<link rel="import" href="../polymer/polymer-element.html"/>

<link rel="import" href="cosmoz-omnitable-repeater-mixin.html" />
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html" />

<dom-module id="cosmoz-omnitable-group-row">
	<template>
		<slot name="group-row"></slot>
	</template>
	<script>
		window.Cosmoz = window.Cosmoz || {};

		/**
		 * @polymer
		 * @customElement
		 * @appliesMixin Cosmoz.OmnitableRepeaterMixin
		 */
		class OmnitableGroupRow extends Cosmoz.OmnitableRepeaterMixin(
			Polymer.Element
		) {
			static get is() {
				return 'cosmoz-omnitable-group-row';
			}

			static get properties() {
				return {
					column: {
						type: Object,
						observer: '_columnChanged'
					},

					item: {
						type: Object
					},

					selected: {
						type: Boolean,
						observer: '_selectedChanged'
					},

					folded: {
						type: Boolean,
						observer: '_foldedChanged'
					}
				};
			}

			static get observers() {
				return [
					'_itemUpdated(item.*)'
				];
			}

			get _elementType() {
				return 'div';
			}

			get _slotName() {
				return 'group-row';
			}

			_columnChanged(newColumn) {
				if (!newColumn) {
					return;
				}
				if (this.columns && this.columns.length > 0) {
					this.splice('columns', 0, 1, newColumn);
					return;
				}
				this.columns = [newColumn];
			}

			/**
			 * @inheritdoc
			 */
			_getTemplateInstance(column) {
				return column.getTemplateInstance(
					Cosmoz.OmnitableTemplatizeMixin.CELL_TEMPLATE,
					{item: this.item, selected: this.selected, expanded: this.expanded}
				);
			}

			_itemUpdated(changeRecord) {
				this.forwardPathChange(changeRecord);
			}

			_selectedChanged(selected) {
				this.forwardChange('selected', selected);
			}

			_foldedChanged(folded) {
				this.forwardChange('folded', folded);
			}
		}
		customElements.define(OmnitableGroupRow.is, OmnitableGroupRow);

		Cosmoz.OmnitableGroupRow = OmnitableGroupRow;
	</script>
</dom-module>
